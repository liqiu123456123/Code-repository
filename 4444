import os
from moviepy.editor import VideoFileClip, clips_array, TextClip, CompositeVideoClip

def add_text_to_video(clip, text, position):
    text_clip = TextClip(text, fontsize=24, color='white', bg_color='black', size=clip.size)
    text_clip = text_clip.set_position(position).set_duration(clip.duration)
    return CompositeVideoClip([clip, text_clip])

def process_videos(folder1, folder2, output_folder):
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)
    
    for filename in os.listdir(folder1):
        file1 = os.path.join(folder1, filename)
        file2 = os.path.join(folder2, filename)

        if os.path.isfile(file1) and os.path.isfile(file2):
            try:
                # 读取视频文件
                video1 = VideoFileClip(file1)
                video2 = VideoFileClip(file2)

                # 确保视频宽度相同
                if video1.size[0] != video2.size[0]:
                    raise ValueError(f"视频宽度不匹配: {filename}")

                # 添加文本备注
                video1_with_text = add_text_to_video(video1, 'Video 1', 'top')
                video2_with_text = add_text_to_video(video2, 'Video 2', 'bottom')

                # 拼接视频
                final_video = clips_array([[video1_with_text], [video2_with_text]])

                # 保存最终视频
                output_file = os.path.join(output_folder, filename)
                final_video.write_videofile(output_file, codec="libx264")
                print(f"处理完成: {filename}")

            except Exception as e:
                print(f"处理 {filename} 时出错: {e}")

# 调用函数处理视频
process_videos('folder1', 'folder2', 'output_folder')
